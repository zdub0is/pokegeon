

const tileBitwise = {
        "0": 22,
        "1": 75,
        "2": 22,
        "3": 75,
        "4": 56,
        "5": 39,
        "6": 56,
        "7": 36,
        "8": 22,
        "9": 75,
        "10": 22,
        "11": 75,
        "12": 56,
        "13": 39,
        "14": 56,
        "15": 36,
        "16": 40,
        "17": 21,
        "18": 40,
        "19": 21,
        "20": 3,
        "21": 74,
        "22": 3,
        "23": 91,
        "24": 40,
        "25": 21,
        "26": 40,
        "27": 21,
        "28": 0,
        "29": 109,
        "30": 0,
        "31": 18,
        "32": 22,
        "33": 75,
        "34": 22,
        "35": 75,
        "36": 56,
        "37": 39,
        "38": 56,
        "39": 36,
        "40": 22,
        "41": 75,
        "42": 22,
        "43": 75,
        "44": 56,
        "45": 39,
        "46": 56,
        "47": 36,
        "48": 40,
        "49": 21,
        "50": 40,
        "51": 21,
        "52": 3,
        "53": 74,
        "54": 58,
        "55": 91,
        "56": 40,
        "57": 21,
        "58": 40,
        "59": 21,
        "60": 0,
        "61": 109,
        "62": 0,
        "63": 18,
        "64": 58,
        "65": 23,
        "66": 58,
        "67": 23,
        "68": 4,
        "69": 73,
        "70": 4,
        "71": 112,
        "72": 58,
        "73": 23,
        "74": 58,
        "75": 111,
        "76": 4,
        "77": 111,
        "78": 4,
        "79": 112,
        "80": 5,
        "81": 76,
        "82": 5,
        "83": 76,
        "84": 55,
        "85": 57,
        "86": 55,
        "87": 127,
        "88": 5,
        "89": 76,
        "90": 75,
        "91": 76,
        "92": 94,
        "93": 113,
        "94": 94,
        "95": 54,
        "96": 58,
        "97": 23,
        "98": 58,
        "99": 23,
        "100": 4,
        "101": 73,
        "102": 4,
        "103": 112,
        "104": 58,
        "105": 23,
        "106": 58,
        "107": 38,
        "108": 4,
        "109": 73,
        "110": 4,
        "111": 112,
        "112": 2,
        "113": 110,
        "114": 2,
        "115": 110,
        "116": 93,
        "117": 129,
        "118": 93,
        "119": 129,
        "120": 2,
        "121": 110,
        "122": 2,
        "123": 110,
        "124": 1,
        "125": 59,
        "126": 1,
        "127": 108,
        "128": 22,
        "129": 75,
        "130": 22,
        "131": 75,
        "132": 56,
        "133": 39,
        "134": 56,
        "135": 36,
        "136": 22,
        "137": 75,
        // "138": 22,
        "139": 75,
        "140": 56,
        "141": 39,
        "142": 56,
        "143": 36,
        "144": 40,
        "145": 21,
        "146": 40,
        "147": 21,
        "148": 3,
        "149": 74,
        "150": 3,
        "151": 91,
        "152": 40,
        "153": 21,
        "154": 40,
        "155": 21,
        "156": 0,
        "157": 109,
        "158": 0,
        "159": 18,
        "160": 22,
        "161": 75,
        // "162": 22,
        "163": 21,
        "164": 56,
        "165": 39,
        "167": 36,
        "168": 22,
        "169": 75,
        "170": 22,
        "171": 75,
        "172": 56,
        "174": 56,
        "175": 36,
        "176": 40,
        "177": 21,
        "178": 40,
        "179": 21,
        "180": 3,
        "181": 74,
        "182": 3,
        "183": 74,
        "184": 40,
        "185": 21,
        "186": 40,
        "187": 21,
        "188": 0,
        "189": 109,
        "190": 0,
        "191": 18,
        "192": 58,
        "193": 38,
        "194": 58,
        "195": 38,
        "196": 4,
        "197": 111,
        "198": 4,
        "199": 37,
        "200": 58,
        "201": 38,
        "203": 38,
        "204": 4,
        "205": 111,
        "206": 4,
        "207": 37,
        "208": 5,
        "209": 92,
        "210": 5,
        "211": 92,
        "212": 55,
        "213": 128,
        "214": 55,
        "215": 72,
        "216": 5,
        "217": 92,
        "218": 5,
        "219": 92,
        "220": 1,
        "221": 130,
        "222": 94,
        "223": 90,
        "224": 58,
        "225": 38,
        "226": 58,
        "227": 38,
        "228": 4,
        "229": 111,
        "230": 4,
        "231": 37,
        "232": 58,
        "233": 38,
        "234": 58,
        "235": 38,
        "236": 4,
        "237": 111,
        "238": 4,
        "239": 37,
        "240": 2,
        "241": 20,
        "242": 2,
        "243": 20,
        "244": 93,
        "245": 41,
        "246": 93,
        "247": 77,
        "248": 2,
        "249": 20,
        "250": 2,
        "251": 20,
        "252": 1,
        "253": 95,
        "254": 1,
        "255": 19
    }

// Example bitmask calculation function
function calculateBitmask(x, y, map) {
    const tileType = map[y][x].terrain_flags.terrain_type;
    let bitmask = 0;
    if (isSameTile(x -1, y, map, tileType)) bitmask += 1;    // N
    if (isSameTile(x - 1, y + 1, map, tileType)) bitmask += 2; // NE
    if (isSameTile(x, y + 1, map, tileType)) bitmask += 4;    // E
    if (isSameTile(x + 1, y + 1, map, tileType)) bitmask += 8; // SE
    if (isSameTile(x + 1, y, map, tileType)) bitmask += 16;   // S
    if (isSameTile(x + 1, y - 1, map, tileType)) bitmask += 32; // SW
    if (isSameTile(x, y - 1, map, tileType)) bitmask += 64;   // W
    if (isSameTile(x - 1, y - 1, map, tileType)) bitmask += 128; // NW

    return bitmask;
}


// Example isSameTile function
function isSameTile(x, y, map, tileType) {
    // Ensure coordinates are within map bounds
    if (y < 0 || y >= map.length || x < 0 || x >= map[y].length) {
        return true;
    }
    // Compare the tile at the given coordinates to the current tile
    return map[y][x].terrain_flags.terrain_type === tileType;
}

// Example mapping of bitmask to tile
// Usage
export function renderGridBitwise(grid) {

    const gridResult = [];
    const gridData = [];
    for (let y = 0; y < grid.length; y++) {
        const row = [];
        const rowDat = [];
    for (let x = 0; x < grid[y].length; x++) {
        const bitmask = calculateBitmask(x, y, grid);
        if (!tileBitwise[bitmask] && tileBitwise[bitmask] != 0) console.log(y, x, bitmask);
        row.push(tileBitwise[bitmask] !== undefined ? tileBitwise[bitmask] : 131);
        rowDat.push(bitmask)
    }
    gridResult.push(row);
    gridData.push(rowDat);

    }
    console.log(gridData);
    return gridResult;
}

